<section class="s-title-page">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-7">
        <h1><%= t('deals.index.deals') %></h1>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-5">
        <h2><%= @deals.count %> <%= t('deals.index.deals') %></h2>
        <a href="/deals/new"><%= t('deals.index.new') %></a>
      </div>
    </div>
  </div>
</section>

<%= render partial: 'filters' %>

<section class="s-table-results">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <%= render partial: 'shared/flash_messages' %>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6">
        <p class="results">
          <%= page_entries_info @deals_paginated, entry_name: t('deals.index.display') %>
        </p>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6">
        <a href="/deals.xlsx" class="btn-export">
          <img src="/img/export.svg" alt="">
          <%= t('deals.index.export') %>
        </a>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <%= render 'shared/sortable_header', url: deals_path,
                                                     label: t('deals.index.column_company'),
                                                     type: 'name',
                                                     order: params[:order] %>

                <%= render 'shared/sortable_header', url: deals_path,
                                                     label: t('deals.index.column_close_date'),
                                                     type: 'close_date',
                                                     order: params[:order] %>
                <th><%= t('deals.index.column_deal_type') %> </th>
                <th><%= t('deals.index.column_investors') %> </th>
                <%= render 'shared/sortable_header', url: deals_path,
                                                     label: t('deals.index.column_amount'),
                                                     type: 'amount_cents',
                                                     order: params[:order] %>
                <th></th>

                <% if user_admin? || user_moderator? %>
                  <th></th>
                  <th></th>
                <% end %>
              </tr>
            </thead>
            <tbody>
              <% @deals_paginated.each do |deal| %>
                  <tr class="clickable-row" data-href=<%= "/deals/#{deal.id}" %>>
                      <td>
                        <img src=<%= deal.company&.profile_image_url || '/img/companies.svg' %> alt="">
                        <%= link_to(deal.company.name, company_path(deal.company.permalink)) %>
                      </td>
                      <td><%= I18n.l(deal.close_date, format: :default) %></td>
                      <td><%= I18n.t("deals.model.categories.#{deal.category}") %></td>
                      <td><%= investors_link(deal) %></td>
                      <td><%= format_amount(deal.amount, deal.amount_currency) %></td>
                      <td>
                        <a href="/deals/<%= deal.id %>">
                          <img src="/img/seta-dir.svg" alt="">
                        </a>
                      </td>
                      <% if user_admin? || user_moderator? %>
                        <td>
                          <%= link_to 'Delete', deal_path(deal.id),
                                                class: 'btn btn-danger',
                                                method: :delete,
                                                data: { confirm: "Are you sure you want to delete?" } %>
                        </td>
                        <td><a href="/deals/<%= deal.id %>/edit" class="btn btn-default">Edit</a></td>
                      <% end %>
                  </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <%= paginate @deals_paginated %>
      </div>
    </div>
  </div>
</section>
